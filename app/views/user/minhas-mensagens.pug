extends ../layouts/default

block styles
  link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css')
  style(type='text/css').
    .fotoProduto .material-placeholder {
      height: 400px;
    }
    .fotoProduto img {
      height: 100%;
      width: auto;
    }
    .fotoProduto a {
      color: white;
      font-weight: 900;
      font-size: 15px;
      text-shadow: 2px 2px 2px black;
    }
    .fotoProduto .left-align a {
      margin-left: 10px;
    }
    .fotoProduto .right-align a {
      margin-right: 10px;
    }

    .fotoProduto .carousel.carousel-slider.center {
      height: 400px !important;
    }

    .fotoProduto span {
      background-color: transparent !important;
    }

    .dadosComercio .collection {
      z-index: -1;
    }

    .carousel-item.active.aberto {
      z-index: 1 !important;
    }
    .image_place img {
      width: 100% !important;
      height: auto;
      border: 5px solid white;
    }
    .carroca img {
      width: calc(50% - 10px) !important;
      height: auto;
      margin: 5px;
      border: 5px solid white;
    }
    .carousel .indicators .indicator-item {
      margin: 40px 4px !important;
    }
    .upload-image {
      top: -32px;
      width: 100%;
      margin: 0;
    }
    .upload-image .btn{
      width: 100%;
      padding: 0 30px;
      margin-left: 0 !important;
      border-top: 1px solid gainsboro;
      border-radius: 0 0 5px 5px;
    }
    .upload-image span{
      font-size: 17px !important;
      margin-top: 0px !important;
      color: #3fa084 !important;
      font-weight: 900 !important;
    }
    .upload-image i.material-icons {
      font-size: 40px !important;
      float: left !important;
      color: #3fa084 !important;
    }
    .character-counter {
      margin: 0 !important;
    }
    img.avatar {
      height: 100%;
      width: auto;
    }
    .avatar-wrapper {
      position: relative !important;
      height: 180px;
      overflow: hidden;
      padding: 0 !important;
      margin-top: 20px;
      border: 0.5rem solid white;
    }
    .avatar-wrapper .file-field.input-field {
      position: absolute;
      bottom: 13px;
      left: 13px;
    }
    .avatar-wrapper .btn {
      margin-left: 0 !important;
      height: 36px !important;
      padding: 0 12px;
      position: relative;
      line-height: 2.5rem !important;
    }
    .avatar-wrapper .material-icons {
      font-size: 1rem;
    }
    .avatar-wrapper input#image-avatar {
      width: 100%;
      height: 36px;
    }
    .avatar-wrapper #avatar-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      z-index: 9999999;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      display: none;
    }
    .avatar-wrapper.edit #avatar-backdrop {
      display: inherit;
    }
    .avatar-wrapper.edit img.avatar {
      z-index: 99999999999999999999999999999999999999999;
      position: relative;
    }
    .avatar-wrapper.has-avatar .btn {
      opacity: 0;
    }
    .avatar-wrapper.has-avatar:hover .btn {
      opacity: 1;
    }
    .img-edit {
      position: absolute;
      left: 200px;
      height: 150px;
      width: 100%;
      border-radius: 10px;
      z-index: 99999999999999999999999;
      top: 35px;
      padding: 20px;
      background-color: rgb(236, 236, 236);
      display: none;
    }
    .img-edit.edit {
      display: block;
    }
    .img-edit h5 {
      text-align: center;
      color: black;
    }
    .img-edit button.enviar {
      float: right;
    }

    .btnDecoracao {
      min-height: 50px !important;
    }
    .btnDecoracao .file-field {
      margin: 0;
    }
    .btnDecoracao .btn.btnacoes {
      margin-left: 0 !important;
      height: 36px;
      padding: 0 1rem;
      position: relative;
      line-height: 2.4rem;
      width: 100%;
    }
    .btnDecoracao .btn.btnacoes i {
      width: 20px !important;
      font-size: 1.5rem !important;
    }

    #selos-negocio .row {
      margin-bottom: 1.5rem !important;
    }

    #selos-negocio .col {
      padding: .5rem 1.2rem !important;
    }

    #modal-selos {
      max-height: 100%;
    }
    #modal-selos .modal-content {
      padding: 0;
    }
    #modal-selos .container {
      padding: 0 50px;
    }
    #modal-selos p {
      margin: 0;;
    }
    #modal-selos .selo-box {
      padding: .5rem;
      margin: 0 .25rem;
      background: rgba(175, 215, 202, 0.28);
      position: relative;
    }
    #modal-selos .selo-box .img-box {
      padding: 0rem 1.5rem;
    }
    #modal-selos .selo-box p {
      text-align: center;
    }
    a#local-info {
      font-size: 20px;
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 10px;
      background: white;
      text-align: center;
      letter-spacing: 2px;
      line-height: 11px;
      margin-left: 3px;
      margin-top: 10px;
    }
    #modal-selos .carousel {
      overflow-y: scroll;
    }
    #modal-selos .carousel .carousel-item {
      width: 100% !important;
    }
    #modal-selos .subtipo.chose .collapsible-header {
      background: #3fa084;
      color: white;
    }
    .tabs .indicator {
      background: #c83579 !important;
    }
    .tabs .tab a {
      color: #c83579 !important;
    }
    .tabs .tab a:hover, .tabs .tab a.active {
      color: #c83579 !important;
    }

    #mapa {
      width: 100%;
      height: 250px;
    }

    /* User */
    ul#user_info li:hover {
      background-color: rgba(200, 53, 121, 0.1);
    }
    ul#user_info li {
      cursor: pointer;
    }
    ul#user_info li.active {
      background-color: #c83579;
      color: white;
    }
    ul#user_info li.active i.pink-text.lighten-2 {
      color: white !important;
    }
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
block content
  include ../partials/perfil-header
  
  .linhapontilhada
  section.comercio
    .container
      .row
        .col.s12.m4.l4
          ul#user_info.collection
            each remetente, index in remententes
              - var act = ''
              if index === 0
                - act = 'active'
              li.collection-item(data-action='#'+remetente._id, class=act)
                i.small.pink-text.lighten-2.left 1
                | #{remetente.de.profile.first_name.charAt(0).toUpperCase()}#{remetente.de.profile.first_name.slice(1)} #{remetente.de.profile.second_name.charAt(0).toUpperCase()}.
        each remetente in remententes
          .page.active.col.s12.m8.l8(id=remetente._id)
            .row
              .col.s12.m12.l12
                each msg, index in mensagens
                  if (JSON.stringify(remetente.de._id) === JSON.stringify(msg.de._id) || JSON.stringify(remetente.de._id) === JSON.stringify(msg.para._id))
                    .s12.m12.l12.col.cards
                      .card.z-depth-5
                        .card-content(style='padding-top: 10px; padding-bottom: 0px;')
                          .row(style='margin-bottom: 0px;')
                            .col.s1.m1.l1
                              if (msg.de.profile.picture)
                                img.circle.responsive-img(src=msg.de.profile.picture)
                              else
                                img.circle.responsive-img(src='/img/avatar-default.png')
                            .col.s11.m11.l11(style='line-height: 0rem;')
                              .row
                                .col.s12.m12.l12
                                  a.card-title.cardNome(href='/user/' + msg.de._id)
                                    | #{msg.de.profile.first_name.charAt(0).toUpperCase()}#{msg.de.profile.first_name.slice(1)} #{msg.de.profile.second_name.charAt(0).toUpperCase()}.
                        .card-content(style='padding: 0 10px 10px 10px;')
                          - var bod = msg.msg
                          - bod = bod.split('\n')
                          each b in bod
                            if (b.length > 1)
                              p= b
                            else
                              br
                        .card-action
                          .row(style='margin-bottom: 0;')
                            a.responder(href='', data-index=remetente.de._id) Responder
          .modal.bottom-sheet(style='max-height: 100%;', id='modal-' + remetente.de._id)
            form(action='/user/' + remetente.de._id + '/mensagem', method='POST')
              input(type='hidden', name='_csrf', value=_csrf)
              .modal-content
                h4 Escreva a menssagem
                .row
                  .col.s12.m12.l12
                    .file-field.input-field
                      textarea#mensagem.materialize-textarea(placeholder='MENSAGEM', name='msg', required)
                      label(for='mensagem')
                br
              .modal-footer
                button.btn.left Enviar
                a.btn.right.modal-close Cancelar
block scripts
  script(src='https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js')
  script(src='/js/lib/load-image.min.js')
  script(type='text/javascript').
    $(document).ready(function() {
      $('ul#user_info li').on('click', function(e) {
        const id = e.target.dataset.action;
        console.log(id);
        $('.page').removeClass('active');
        $('ul#user_info li').removeClass('active');
        $(this).addClass('active');
        $(id).addClass('active');
      })

      $('.login').on('click', function(e) {
        e.preventDefault();
        $('#modal-login').modal('open');
      });

      $('.responder').on('click', function(e) {
        e.preventDefault();
        $('#modal-' + e.currentTarget.dataset.index).modal('open');
      });
    })
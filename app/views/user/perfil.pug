extends ../layouts/default

block content
  section.cadastro
    .container
      .row
        .col.s12.breadcrumb
          h4 Informações de Perfil
        .col.s12.m6.l6
          form(id='edit-profile-form', method='POST', action='/account/profile')
            input(type='hidden', name='_csrf', value=_csrf)
            label(for='first_name') Primeiro Nome
            input#first_name.validate(placeholder='Primeiro Nome', type='text', name="first_name", value=user.profile.first_name)
            label(for='second_name') Segundo nome
            input#second_name.validate(placeholder='Segundo Nome', type='text', name="second_name", value=user.profile.second_name)
            .row
              .col.s12.m6.l6
                label(for='estado') ESTADO
                select#estados(name='estado')
                  option.corinput(value='') SELECIONAR...
              .col.s12.m6.l6
                label(for='cidade') CIDADE
                select#cidades(name='cidade')
                  option.corinput(value='') SELECIONAR...
            label ANIVERSÁRIO
            .row
              .input-field.col.s4
                select(name='aniv_dia')
                  option(value='', disabled='', selected='') DIA
                  option(value='1') 1
                  option(value='2') 2
                  option(value='3') 3
                  option(value='4') 4
                  option(value='5') 5
                  option(value='6') 6
                  option(value='7') 7
                  option(value='8') 8
                  option(value='9') 9
                  option(value='10') 10
                  option(value='11') 11
                  option(value='12') 12
                  option(value='13') 13
                  option(value='14') 14
                  option(value='15') 15
                  option(value='16') 16
                  option(value='17') 17
                  option(value='18') 18
                  option(value='19') 19
                  option(value='20') 20
                  option(value='21') 21
                  option(value='22') 22
                  option(value='23') 23
                  option(value='24') 24
                  option(value='25') 25
                  option(value='26') 26
                  option(value='27') 27
                  option(value='28') 28
                  option(value='29') 29
                  option(value='30') 30
                  option(value='31') 31
              .input-field.col.s4
                select(name='aniv_mes')
                  option(value='', disabled='', selected='') MÊS
                  option(value='1') 1
                  option(value='2') 2
                  option(value='3') 3
                  option(value='4') 4
                  option(value='5') 5
                  option(value='6') 6
                  option(value='7') 7
                  option(value='8') 8
                  option(value='9') 9
                  option(value='10') 10
                  option(value='11') 11
                  option(value='12') 12
              .input-field.col.s4
                select(name='aniv_ano')
                  option(value='', disabled='', selected='') ANO
                  option(value='1978') 1978
                  option(value='1979') 1979
                  option(value='1980') 1980
                  option(value='1980') 1980
                  option(value='1981') 1981
                  option(value='1982') 1982
                  option(value='1983') 1983
                  option(value='1984') 1984
                  option(value='1985') 1985
                  option(value='1986') 1986
                  option(value='1987') 1987
                  option(value='1988') 1988
                  option(value='1989') 1989
                  option(value='1990') 1990
                  option(value='1991') 1991
                  option(value='1992') 1992
                  option(value='1993') 1993
                  option(value='1994') 1994
                  option(value='1995') 1995
                  option(value='1996') 1996
                  option(value='1997') 1997
                  option(value='1998') 1998
                  option(value='1999') 1999
                  option(value='2000') 2000
                  option(value='2001') 2001
                  option(value='2002') 2002
                  option(value='2003') 2003
                  option(value='2004') 2004
                  option(value='2005') 2005
                  option(value='2006') 2006
                  option(value='2007') 2007
                  option(value='2008') 2008
                  option(value='2009') 2009
                  option(value='2010') 2010
                  option(value='2011') 2011
                  option(value='2012') 2012
                  option(value='2013') 2013
                  option(value='2014') 2014
                  option(value='2015') 2015
                  option(value='2016') 2016
                  option(value='2017') 2017
            .row
              .input-field.col.s12
                p Gênero
                p(style='float: left; margin-right: 20px;')
                  input.with-gap(type='radio', checked=user.profile.gender=='male', name='gender', value='male', data-toggle='radio', id='male')
                  label(for='male') Masculino
                p(style='float: left; margin-right: 20px;')
                  input.with-gap(type='radio', checked=user.profile.gender=='female', name='gender', value='female', data-toggle='radio', id='female')
                  label(for='female') Feminino
                p(style='float: left; margin-right: 20px;')
                  input.with-gap(type='radio', checked=user.profile.gender=='other', name='gender', value='other', data-toggle='radio', id='other')
                  label(for='other') Outro
            button.pink.lighten-2.waves-effect.waves-light.btn.right Atualizar Perfil
          .divider(style='margin-top: 150px;')
          .row
            h4 Mudar Senha

            form.col.s12(action='/account/password', method='POST')
              input(type='hidden', name='_csrf', value=_csrf)
              .row
                .input-field.col.s12
                  input.validate(type='password', name='password', id='password')
                  label(for='password') Nova Senha
              .row
                .input-field.col.s12
                  input.validate(type='password', name='confirmPassword', id='confirmPassword')
                  label(for='confirmPassword') Confirmar Senha
              .row
                .input-field.col.s12
                  button.pink.lighten-2.waves-effect.waves-light.btn.right(type='submit')
                    | Mudar Senha
                    i.material-icons.right vpn_key
        .col.s3.hide-on-small-only
        .col.s12.m3.l3
          if (user.profile.picture)
            img#avatar.avatar.responsive-img.z-depth-2(src=user.profile.picture, style='padding: 10px;')
          else
            img#avatar.avatar.responsive-img.z-depth-2(src='/img/avatar-default.png', style='padding: 10px;')
          form#avatar-form(action='/eu/' + user._id + '/avatar/upload', method='POST', enctype='multipart/form-data')
            input#avatar-offset(type='hidden',value='0px', name='offset')
            .file-field.input-field
              .btn.pink.lighten-2(style='width: 100%; margin-left: 0 !important;')
                i.material-icons.left.white-text add_a_photo
                | Mudar Foto
                if (device)
                  input#image-avatar(type='file', name='photos', style='', accept='image/*', capture='camera')
                else
                  input#image-avatar(type='file', name='photos', style='')
              .file-path-wrapper(style='display: none;')
                input.file-path.validate(type='text', placeholder='Upload one or more files')
          .row
            .col.s12.m12.l12(style='margin-top: 25px;')
              .divider
              h5 Contas associadas
              if user.facebook
                a.btn.waves-effect.waves-light.red(href='/account/unlink/facebook', style='margin-top: 20px; margin-left: 0 !important; width: 100%;')
                  i.fa.fa-facebook.left
                  | Desligar Conta
              else
                a.btn.waves-effect.waves-light(href='/auth/facebook', style='background: #3b5998; margin-top: 20px; margin-left: 0 !important; width: 100%;')
                  i.fa.fa-facebook.left
                  | Associar Conta

block scripts
  script(type='text/javascript').
    $(document).ready(function() {
      $.getJSON('/estados.json', function (data) {
        var items = [];
        var options = '<option value="">escolha um estado</option>';	
        var estado = '#{user.profile.estado}';

        $.each(data, function (key, val) {
          if (estado === val.sigla) {
            options += '<option value="' + val.sigla + '" selected>' + val.nome + '</option>';
          } else {
            options += '<option value="' + val.sigla + '">' + val.nome + '</option>';
          }
        });
        $("#estados").html(options);
        $('select').material_select();
				
        $("#estados").change(function () {				
				
          updateCidades(data);
					
        }).change();

        //- if (estado !== '') {
        //-   $('#estados').parent().find('.select-dropdown').val(estado)
        //- }
      });

      var updateCidades = function(data) {
        var options_cidades = '';
        var str = "";					
        var cidade = '#{user.profile.cidade}';
        
        $("#estados option:selected").each(function () {
          str += $(this).text();
        });
        
        $.each(data, function (key, val) {
          if(val.nome == str) {							
            $.each(val.cidades, function (key_city, val_city) {
              if (cidade === val_city) {
                options_cidades += '<option value="' + val_city + '" selected>' + val_city + '</option>';
              } else {
                options_cidades += '<option value="' + val_city + '">' + val_city + '</option>';
              }
            });
          }
        });

        $("#cidades").html(options_cidades);
        $('select').material_select();
        //- $('#cidades').parent().find('.select-dropdown').val(cidade);
      }
    })